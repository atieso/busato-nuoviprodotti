services:
  - type: cron
    name: export-nuovi-prodotti
    runtime: python
    schedule: "0 6 * * *"
    envVars:
      - key: SHOPIFY_STORE
        value: a86246.myshopify.com
      - key: SHOPIFY_TOKEN
        value: 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
      - key: FTP_HOST
        value: ftp.andreat257.sg-host.com
      - key: FTP_USER
        value: admin@andreat257.sg-host.com
      - key: FTP_PASS
        value: 33;k;gk|k^y2
      - key: FTP_PATH
        value: /public_html/IMPORT_DATI_FULL_20230919_0940/ARTICOLI.CSV
      - key: OUTPUT_FILE
        value: NUOVI_PRODOTTI.csv
      - key: TZ
        value: Europe/Rome
    buildCommand: pip install --upgrade pip && pip install --no-cache-dir -r requirements.txt
    startCommand: >-
      bash -lc 'set -euo pipefail;
      echo "RUN $(date) â€” store=$SHOPIFY_STORE, out=$OUTPUT_FILE";
      python3 export_new_products_from_ftp.py --ftp-host "$FTP_HOST" --ftp-user "$FTP_USER" --ftp-pass "$FTP_PASS" --ftp-path "$FTP_PATH" --out "$OUTPUT_FILE";
      ls -lah "$OUTPUT_FILE" || true'
